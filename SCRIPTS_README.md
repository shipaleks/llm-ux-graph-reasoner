# Инструкции по использованию улучшенных скриптов

Этот документ описывает скрипты для анализа текстов, создания графов знаний и генерации интерактивных отчетов.

## Основные скрипты

### 1. Анализ текста

```bash
# Стандартный анализ текстового файла
./analyze_text.py path/to/file.txt

# Анализ с расширением графа и генерацией теорий
./analyze_text.py path/to/file.txt --expand --theories
```

### 2. Анализ больших текстов

```bash
# Анализ большого текстового файла с ограничением по сегментам
./analyze_large_text.py path/to/large_file.txt --max-segments 1000
```

### 3. Восстановление отчетов

```bash
# Создание улучшенного отчета из существующей директории анализа
./fix_report_improved.py output/20250306_123542 "Название исходного файла"
```

### 4. Исправление ссылок на сегменты

```bash
# Исправление ссылок на сегменты в отчетах
./fix_and_open.py --dir output/20250306_123542
```

## Предотвращение ошибок при анализе больших текстов

При анализе больших текстов рекомендуется:

1. Использовать скрипт `analyze_large_text.py` с ограничением количества сегментов
2. Постепенно увеличивать лимит сегментов, если анализ успешен
3. Если возникает ошибка, использовать `fix_report_improved.py` для создания отчета из промежуточных данных

## Сценарии использования

### Новый анализ текста

```bash
# Анализ нового текста с ограничением в 500 сегментов
./analyze_large_text.py path/to/file.txt --max-segments 500 --theories
```

### Восстановление после ошибки

Если анализ завершился с ошибкой, вы можете создать отчет из уже обработанных данных:

```bash
# Найдите последнюю директорию с данными
ls -la output/

# Создайте улучшенный отчет
./fix_report_improved.py output/YYYYMMDD_HHMMSS "Название файла"
```

### Открытие отчета в браузере

После создания отчета вы можете открыть его в браузере:

```bash
# Для macOS
open output/YYYYMMDD_HHMMSS/improved_report.html

# Для Linux
xdg-open output/YYYYMMDD_HHMMSS/improved_report.html
```

## Улучшения в новых скриптах

1. **Ограничение количества обрабатываемых сегментов** для предотвращения ошибок памяти
2. **Безопасный доступ к индексам** в больших массивах данных
3. **Улучшенный отчет** с интерактивными графиками и вкладками
4. **Автоматическое восстановление** в случае сбоя в процессе анализа
5. **Исправление ссылок на сегменты** в отчетах

## Структура отчета

Улучшенный отчет содержит следующие разделы:

1. **Граф знаний** - интерактивная визуализация графа
2. **Сущности** - сгруппированные по типу сущности с графиком распределения
3. **Отношения** - сгруппированные по типу отношения между сущностями
4. **Отчет о графе** - текстовый отчет о метриках и структуре графа

## Примечания

- Для анализа файлов на русском языке система автоматически определит язык и создаст отчет на русском языке
- При обработке очень больших текстов (более 5000 сегментов) рекомендуется разделить файл на несколько частей
- Все скрипты генерируют подробные логи, которые могут помочь при отладке проблем